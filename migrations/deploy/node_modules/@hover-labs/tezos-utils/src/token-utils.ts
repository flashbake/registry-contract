/** Utilities for working with tokens. */

import BigNumber from 'bignumber.js'
import { TezosToolkit } from '@taquito/taquito'

/**
 * Get an FA1.2 token balance.
 *
 * This probably only works for kUSD, but should also be compatible with any other vanilla FA1.2 contract from SmartPy.
 *  
 * @param holderAddress The address to get the balance of.
 * @param tokenContractAddress The address of the token contract
 * @param tezos A configured TezosToolkit.
 */
export async function getTokenBalanceFromDefaultSmartPyContract(holder: string, tokenContractAddress: string, tezos: TezosToolkit): Promise<BigNumber> {
  const tokenContract = await tezos.contract.at(tokenContractAddress)
  const tokenStorage: any = await tokenContract.storage()
  const accountData = await tokenStorage.balances.get(holder)

  if (accountData === undefined) {
    return new BigNumber(0)
  }
  return accountData.balance
}
